-- Neovim のスタートアップ画面をカスタマイズするプラグイン
local tool_1992_2001 = {
  [[ IBYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYBI ]],
  [[ Iz                                                                                                                      zI ]],
  [[ Iz                                                                                                                      zI ]],
  [[ Iz    ..........................      ..............-               ................       ..............               zI ]],
  [[ Iz   (WNM#HH#HHHHH##H#H#HH##MMMR_ .-jHM###########HHMNmJ.       .(gMMMHH####H#H###MMNa..  .W##H#H#H#MMM#:               zI ]],
  [[ Iz   (H#HHHHHMHHHHHMMHHH#H#HH#MD-(HMMM#HHHHMMMMHHHH#HHH#MH+   .jHM#HHH#H#MMMMM#MHMHHH#MN&..W#MHHHHHHHH##;               zI ]],
  [[ Iz   (WMMMMMMMHH#HHMMHH#MMMMMMMSdMMHHHMHHM9=!~_?TMMHHHHHH#N{ .dMMM#M##MMY?~  _?MMHHHHHH#N{.TMM#HHHHHHH##!               zI ]],
  [[ Iz          (XHHHHHHMH#M>      .dMHHHMH##N:      dMHHHHHHHN} .dHM#HMHHMN_      dMHHHHHH#N{  (d#HHHHHHH##!               zI ]],
  [[ Iz           d##HH#H#H#M:      .dM#HHMHH#N:      dMHHHHHH#N}  d##HHHHH#N:      dMHHH#HH#N{  -XMHHHHHHH##:               zI ]],
  [[ Iz           X#H#M#HMH#M>       d#HHHHHH#N:      d#HHHHHH#N} .dHHH#HH##N:      dMHHHHHH#N{  -dMMH#HHHH##!               zI ]],
  [[ Iz           X#HHHHHMH#M>       dHHHHMHH#N:      d#HH#HHH#N} .dH##HMHH#N!      dMHHHHHH#N{  -d#HHHHHHH##:               zI ]],
  [[ Iz           X##MMHHHHHM>      .dHHHHMMHMN:      dMHMH#HH#N} .dHH#HH#HMN!      dMHMMHMHNN{  .dMHHMMMHMM#;   (((((J.     zI ]],
  [[ Iz           XHH#MHMH#HMe,      d#HHHHHHHN>     .dMHMM#HH#N} .dH#MHHMHMN+     .dM#MMH#H#N{  (dM#HHHHHH#N&..(W##MMMl     zI ]],
  [[ Iz           X##HHHMHHM#Mb      ZM#MHHHHMMNmg++gMMMMMHHHMM#>  ?M#MMMMHHMNmagjgM##H#M#M#M@:  (dM#HHHHHH#H#MMMHMHHHMl     zI ]],
  [[ Iz           XM#H#####MHMD       ?TMMH#MHMH#H#HHHHHHMMHM#Y!    _TMMMHHMHH#HH#M#MMMMNHMB3    -d###MM######MH###M#NMl     zI ]],
  [[ Iz           XM#H#####MHMD          ?7TMMMMMMMMMMMMMBY7~          _?TTMMMMMMMMMMMHY=!        ?<<<<<<<<<<<<<<<<<<?<      zI ]],
  [[ Iz                                                                                                                      zI ]],
  [[ Iz                                                                                                                      zI ]],
  [[ Ib                                                                                                                      dI ]],
  [[ IBXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXkBI ]],
}

local tool_2001_2006 = {
  [[           __/*                                                                                 '_1*G ]],
  [[     .!|}%pO888.                                                                           .|/wq$8888 ]],
  [[     >888888888.                                                                           e888888888 ]],
  [[ """"}888888888!""""`                                                                      e888888888 ]],
  [[ 888888888888888888p"                                                                      e888888888 ]],
  [[ ||||I$88888888>|||r'               .?4kkkL;                         :/Pkkk|,              e888888888 ]],
  [[     "p88888888.                 _<%888888882"                    `TP88888888C_            e888888888 ]],
  [[     "p88888888.               !k8888888888888y.               .=98888888888888u           e888888888 ]],
  [[     "p88888888699999999999999p8888888888888888ppppppppppppppppd8888888888888888p9999999999$888888888 ]],
  [[     "p888888888888888888888881-,388888888888888888888888888888+,-t8888888888888888888888888888888888 ]],
  [[     "p888888888888888888888E~    ;t88888888888888888888888888;    :(88888888888888888888888888888888 ]],
  [[     "p888888888888888888888J       .(p8888888888888888888888o.      'lO88888888888888888888888888888 ]],
  [[     "p8888888888888888888882`        "%888888888888888888888p.        `P8888888888888888888888888888 ]],
  [[     "p8888888888888888888888}         .5888888888888888888888o,        `2888888888888888888888888888 ]],
  [[     "p88888888888888888888888Oc";.    `L8888888888888888888888Dn^;`    `V888888888888888888888888888 ]],
  [[     "p888888888888888888888888888Hdddd$888888888888888888888888888$dddd$8888888888888888888888888888 ]],
  [[     "p8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888 ]],
  [[     "p8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888 ]],
  [[     "p88888888#++++++++=ooU88888888bo>++++++++++++++++++To2O88888888%o=++++++++++++++++++++888888888 ]],
  [[      .````````.           .````````.                       .````````.                      ````````` ]],
}

local tool_2006_2019 = {
  [[           ............................................................................................................         ]],
  [[        .MMMMMMMMB"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""WMMMMMMMMN&       ]],
  [[        MMMMMMMMM                                                                                             ,MMMMMMMMMb       ]],
  [[        MMMMMMMMM                                                                                             ,MMMMMMMMM#       ]],
  [[       .MMMMMMMMM,                                                                                            ,MMMMMMMMM#       ]],
  [[  ....JMMMMMMMMMMMg...,     ................................          ................................        ,MMMMMMMMM#       ]],
  [[  ???"MMMMMMMMMMM"???`   .MMMMMMMM#"?????????????TMMMMMMMMMN,      .MMMMMMMMM"7????????????7WMMMMMMMMMe       ,MMMMMMMMM#       ]],
  [[       MMMMMMMMM:       .MMMMMMMMM                .MMMMMMMMMN.    .MMMMMMMMM%                MMMMMMMMMM]      ,MMMMMMMMM#       ]],
  [[       MMMMMMMMM_       gMMMMMMMMN                .MMMMMMMMMM)    ,MMMMMMMMM[                dMMMMMMMMMF      ,MMMMMMMMM#       ]],
  [[       MMMMMMMMM_       gMMMMMMMMN                .MMMMMMMMMM)    ,MMMMMMMMM[                dMMMMMMMMMF      ,MMMMMMMMM#       ]],
  [[       MMMMMMMMM_       gMMMMMMMMN                .MMMMMMMMMM)    ,MMMMMMMMM[                dMMMMMMMMMF      ,MMMMMMMMM#       ]],
  [[       MMMMMMMMM_       gMMMMMMMMN                .MMMMMMMMMM)    ,MMMMMMMMM[                dMMMMMMMMMF      ,MMMMMMMMM#       ]],
  [[       MMMMMMMMM_       gMMMMMMMMN                .MMMMMMMMMM)    ,MMMMMMMMM[                dMMMMMMMMMF      ,MMMMMMMMM#       ]],
  [[       HMMMMMMMM,       (MMMMMMMMN.               .MMMMMMMMMM`    .MMMMMMMMM]                dMMMMMMMMMF      .MMMMMMMMMN       ]],
  [[        TMMMMMMMMg.......dMMMMMMMMNa.............JMMMMMMMMMMa.......MMMMMMMMMN..............MMMMMMMMMMN......&MMMMMMMMMMMNJ.... ]],
  [[          """"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""` ]],
}

local tool_2019 = {
 [[                        ...........................         ....                ....              .}                                              ]],
 [[                    .d9=<???????????????????<2!!!!!     .J=! .! ?Ta,        .-Y^`.] ?7n,          .}                                              ]],
 [[                   .d=                       .N        .d=    ,~    ?m.     J5`   .r    ?N,        d}                                             ]],
 [[                  .H{                        .Z;      .#>     ,~     ?N.   d$`    .r     (M,      .0}                                             ]],
 [[ .................(K..........................lj......dh-......~     (d]  .#>     .r......XN......2({............................................ ]],
 [[ 7????????????????????<??<<<<<<<<<<<<<<<<????<2?1/????1u/?????<~     (K\  ,Xr     .r?????<QZ????<2?1<???????????????<<<<<<<<<<d2<<??????????????? ]],
 [[                                             .)  ?+   .dL     ,~     d3`   zN.    .r     .@>   .=  ,}                        .#!                  ]],
 [[                                             .)    7.. _d&    ,~    (5`     ?b.   .r    .@>  .7    ,}                       .#>                   ]],
 [[                                             .)      (=(.?S,  ,~  .Y!        (4.. .r  .J3(.?^      ,}                   ...V=`                    ]],
 [[                                             .'           !??77=7!              ?77"77!!`          .7<<<<<<<<<?7777777777!`                       ]],
}

local tool_army_icon = {
  [[                                                                                                    ]],
  [[                                                *%#(                                                ]],
  [[                                             ,%#######(                                             ]],
  [[                                          .#####*  .#####*                                          ]],
  [[                                        #####/        ,#####,                                       ]],
  [[                                     /####(              *####%.                                    ]],
  [[                                  *#####.                   /####(                                  ]],
  [[                ,/*///////////*/######************************(#####(**////////////*                ]],
  [[                /###################################################################                ]],
  [[                /###.     (####/                                    .#####.     %###                ]],
  [[                /###,  /####(                                          *%####.  %###                ]],
  [[                /###(%####.                                               /####(####                ]],
  [[                /#####%,                                                     (######                ]],
  [[               #####/                                                          .#####,              ]],
  [[            (#######,                                                           %#######.           ]],
  [[         /#####./###,                                                           %### /####(         ]],
  [[      ,#####,   /###,                                                           %###    (####/      ]],
  [[   .%####*      /###,                                                           %###      .#####*   ]],
  [[ /####(         /###,                                                           %###         ,%#### ]],
  [[  /###/         /###,                                                           %###         .%###  ]],
  [[   /###(        /###,                                                           %###        .####   ]],
  [[    ,####       /###,                                                           %###       *###(    ]],
  [[     .%###      /###.                                                           %###      /###/     ]],
  [[       ###%.    /###.                                                           %###     ((##*      ]],
  [[        %###.   /###.                                                           %###    ####.       ]],
  [[         ####,  /###,                                                           %###   ####.        ]],
  [[          (###* /###,                                                           %### .%##%          ]],
  [[           /###//###,                                                           %###,####           ]],
  [[            *#######,                                                           %#######            ]],
  [[             ,######,                                                           %######             ]],
  [[              .#####.                                                           %####/              ]],
  [[                ###%,                                                           %##%,               ]],
  [[                                                                                                    ]],
}

vim.cmd [[
hi IconArmy ctermfg=214 guifg=#E61032
hi StartLogo1 ctermfg=214 guifg=#CCD1D1
hi StartLogo2 ctermfg=214 guifg=#B2BABB
hi StartLogo3 ctermfg=214 guifg=#99A3A4
hi StartLogo4 ctermfg=214 guifg=#7F8C8D
hi StartLogo5 ctermfg=214 guifg=#65777B
hi StartLogo6 ctermfg=214 guifg=#4D5658
hi StartLogoPop1 ctermfg=214 guifg=#EC9F05
hi StartLogoPop2 ctermfg=208 guifg=#F08C04
hi StartLogoPop3 ctermfg=208 guifg=#F37E03
hi StartLogoPop4 ctermfg=202 guifg=#F77002
hi StartLogoPop5 ctermfg=202 guifg=#FB5D01
hi StartLogoPop6 ctermfg=202 guifg=#FF4E00
]]

local function lineToStartWhite(lines)
  local out = {}
  for _, line in ipairs(lines) do
    table.insert(out, { hi = "StartLogo" .. 0, line = line })
  end
  return out
end

local function lineToStartArmy(lines)
  local out = {}
  for _, line in ipairs(lines) do
    table.insert(out, { hi = "IconArmy", line = line })
  end
  return out
end

local function lineToStartSilver(lines)
  local out = {}
  local hi = "StartLogo" .. 1
  for i, line in ipairs(lines) do
    if i > 2 and i <= 4 then
      hi = "StartLogo" .. 2
    elseif i > 4 and i <= 6 then
      hi = "StartLogo" .. 3
    elseif i > 6 and i <= 8 then
      hi = "StartLogo" .. 4
    elseif i > 8 and i <= 10 then
      hi = "StartLogo" .. 5
    elseif i > 10 then
      hi = "StartLogo" .. 6
    end
    table.insert(out, { hi = hi, line = line })
  end
  return out
end

local function lineToStartPop(lines)
  local out = {}
  local hi = "StartLogoPop" .. 1
  for i, line in ipairs(lines) do
    if i > 2 and i <= 4 then
      hi = "StartLogoPop" .. 2
    elseif i > 4 and i <= 6 then
      hi = "StartLogoPop" .. 3
    elseif i > 6 and i <= 8 then
      hi = "StartLogoPop" .. 4
    elseif i > 8 and i <= 10 then
      hi = "StartLogoPop" .. 5
    elseif i > 10 then
      hi = "StartLogoPop" .. 6
    end
    table.insert(out, { hi = hi, line = line })
  end
  return out
end

local logo_1992 = lineToStartSilver(tool_1992_2001)
local logo_2001 = lineToStartWhite(tool_2001_2006)
local logo_2006 = lineToStartWhite(tool_2006_2019)
local logo_2019 = lineToStartPop(tool_2019)
local logo_army = lineToStartArmy(tool_army_icon)
local headers = { logo_1992, logo_2001, logo_2006, logo_2019, logo_army }

local function header_chars()
  math.randomseed(os.time())
  return headers[math.random(#headers)]
end

local function header_color()
  local lines = {}
  for _, lineConfig in pairs(header_chars()) do
    local hi = lineConfig.hi
    local line_chars = lineConfig.line
    local line = {
      type = "text",
      val = line_chars,
      opts = {
        hl = hi,
        shrink_margin = false,
        position = "center",
      },
    }
    table.insert(lines, line)
  end

  local output = {
    type = "group",
    val = lines,
    opts = { position = "center", },
  }

  return output
end

return {
  "goolord/alpha-nvim",
  enabled = false,
  event = "VimEnter",
  dependencies = "nvim-tree/nvim-web-devicons",
  config = function()
    local theme = require("alpha.themes.theta")
    local config = theme.config
    local dashboard = require("alpha.themes.dashboard")
    require("alpha.term")
    local buttons = {
      type = "group",
      val = {
        { type = "text",    val = "Quick links", opts = { hl = "SpecialComment", position = "center" } },
        { type = "padding", val = 1 },
        dashboard.button("e", "  > New file", ":ene <BAR> startinsert <CR>"),
        dashboard.button("f", "󰱼  > Find file", ":Telescope find_files find_command=rg,--files,--hidden<CR>"),
        dashboard.button("r", "  > Recent", ":Telescope oldfiles<CR>"),
        dashboard.button("s", "  > Settings", ":e $MYVIMRC | :cd %:p:h | split . | wincmd k | pwd<CR>"),
        dashboard.button("u", "󰚥  > Update Plugins", ":Lazy update<CR>"),
        dashboard.button("q", "󰩈  > Quit NVIM", ":qa<CR>"),
      },
      position = "center",
    }
    local gh_notify = {
      type = "terminal",
      command = "gh notify -s -a -n5",
      width = 120,
      height = 5,
      opts = {
        position = "center",
        redraw = true,
        window_config = {},
      }
    }
    local gh_pr = {
      type = "terminal",
      command = "gh pr list -L 3",
      width = 120,
      height = 7,
      opts = {
        position = "center",
        redraw = true,
        window_config = {},
      }
    }
    local git_status = {
      type = "terminal",
      command = "git status -s",
      width = 120,
      height = 5,
      opts = {
        position = "center",
        redraw = true,
        window_config = {},
      }
    }

    local gh_info = {
      type = "group",
      val = {
        { type = "text",    val = "GitHub Notifications", opts = { hl = "SpecialComment", position = "center" } },
        { type = "padding", val = 1 },
        gh_notify,
        { type = "padding", val = 1 },
        { type = "text", val = "Git Status", opts = { hl = "SpecialComment", position = "center" } },
        { type = "padding", val = 1 },
        git_status,
        { type = "padding", val = 1 },
        { type = "text",    val = "GitHub Pull Requests", opts = { hl = "SpecialComment", position = "center" } },
        { type = "padding", val = 1 },
        gh_pr,
      }
    }

    -- FIXME: 二列で表示する
    config.layout[2] = header_color()
    config.layout[6] = buttons
    config.layout[7] = { type = "padding", val = 2 }
    config.layout[8] = gh_info

    require("alpha").setup(config)
  end
}
